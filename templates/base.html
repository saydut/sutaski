<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="icon" href="{{ url_for('static', filename='images/favicon.ico') }}" type="image/x-icon">
    <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.ico') }}" type="image/x-icon">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#3B82F6"/>
    
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/icon.png') }}">
    
    <title>{% block title %}Süt Takip Sistemi{% endblock %}</title>
    {% block head_extra %}{% endblock %}
</head>
<body
    data-app-version="{{ APP_VERSION }}"
    {% block body_attributes %}{% endblock %}
>

    {% block content %}{% endblock %}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='theme.js') }}"></script>
    <script src="{{ url_for('static', filename='js/utils.js') }}"></script>
    <script src="{{ url_for('static', filename='js/api.js') }}"></script>
    <script src="{{ url_for('static', filename='js/store.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ui.js') }}"></script>
    <script src="{{ url_for('static', filename='js/data-loader.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chart-manager.js') }}"></script>
    <script src="https://unpkg.com/dexie@3/dist/dexie.js"></script>
    <script src="{{ url_for('static', filename='js/offline.js') }}"></script>
    <script src="{{ url_for('static', filename='js/push-manager.js') }}"></script>

<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register("/service-worker.js")
                .then(registration => {
                    console.log('Dinamik Service Worker başarıyla kaydedildi: ', registration);
                })
                .catch(error => {
                    console.log('Dinamik Service Worker kaydı başarısız: ', error);
                });
        });
    }
</script>

    {% block scripts %}{% endblock %}

    <div class="modal fade" id="hakkindaModal" tabindex="-1" aria-labelledby="hakkindaModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="hakkindaModalLabel"><i class="bi bi-info-circle-fill me-2"></i>Süt Takip Sistemi Hakkında</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs" id="hakkindaTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="ozellikler-tab" data-bs-toggle="tab" data-bs-target="#ozellikler-pane" type="button" role="tab" aria-controls="ozellikler-pane" aria-selected="true">Özellikler & Kullanım</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="guncellemeler-tab" data-bs-toggle="tab" data-bs-target="#guncellemeler-pane" type="button" role="tab" aria-controls="guncellemeler-pane" aria-selected="false">Sürüm Notları</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="iletisim-tab" data-bs-toggle="tab" data-bs-target="#iletisim-pane" type="button" role="tab" aria-controls="iletisim-pane" aria-selected="false">İletişim & Destek</button>
                        </li>
                    </ul>

                    <div class="tab-content pt-3" id="hakkindaTabContent">
                        <div class="tab-pane fade show active" id="ozellikler-pane" role="tabpanel" aria-labelledby="ozellikler-tab" tabindex="0">
                            
                            <h5 class="fw-bold">Hızlı Başlangıç Rehberi</h5>
                            <p>Uygulamayı verimli bir şekilde kullanmaya başlamak için aşağıdaki 3 adımı izleyebilirsiniz:</p>
                            <ol>
                                <li><strong>Tedarikçilerinizi Ekleyin:</strong> İlk olarak, menüden "Tedarikçi Yönetimi" sayfasına giderek sisteme süt alımı yaptığınız tüm tedarikçileri kaydedin.</li>
                                <li><strong>Stoklarınızı Tanımlayın:</strong> Ardından, "Yem Yönetimi" bölümünden sattığınız yem ürünlerini ve mevcut stok miktarlarını sisteme girin.</li>
                                <li><strong>Veri Girişine Başlayın:</strong> Artık hazırsınız! Ana panelden günlük süt girdilerinizi ve tedarikçilere yaptığınız yem çıkışlarını kolayca kaydedebilirsiniz.</li>
                            </ol>
<!--                        <hr class="my-4">
                            
                            <h5 class="fw-bold"><i class="bi bi-cloud-slash-fill text-primary me-2"></i>İnternetsiz Çalışma Gücü</h5>
                            <p>
                                İnternet bağlantınızın olmadığı anlarda bile veri girişine devam edebilirsiniz. Girdiğiniz tüm veriler güvenli bir şekilde cihazınıza kaydedilir ve internet bağlantısı kurulduğu an otomatik olarak sunucu ile senkronize edilir. Bu sayede işleriniz asla aksamaz.
                            </p>
                            <hr class="my-4">
                        -->
                            <h5 class="fw-bold">Temel Özellikler</h5>
                            <ul>
                                <li><strong>Kolay Veri Girişi:</strong> Günlük süt girdilerini, yem alımlarını ve finansal işlemleri (ödeme/avans) tek bir yerden hızla takip edin.</li>
                                <li><strong>Akıllı Raporlama:</strong> Grafiksel ve detaylı raporlar (Günlük, Aylık, Tedarikçi Bazlı) ile işletmenizin performansını anlık olarak analiz edin.</li>
                                <li><strong>PDF Dökümanlar:</strong> Tek tuşla tedarikçileriniz için profesyonel "Müstahsil Makbuzu" ve "Aylık Hesap Özeti" gibi PDF belgeleri oluşturun.</li>
                                <li><strong>Esnek Yönetim:</strong> Tedarikçi, yem ve finans yönetimi modülleri ile tüm operasyonel verilerinizi kontrol altında tutun.</li>
                            </ul>
                        </div>

                        <div class="tab-pane fade" id="guncellemeler-pane" role="tabpanel" aria-labelledby="guncellemeler-tab" tabindex="0">
                             <div class="d-flex justify-content-between align-items-center mb-3 p-2 rounded" style="background-color: var(--bs-table-striped-bg);">
                                <h6 class="mb-0">Mevcut Sürüm: {{ APP_VERSION }}</h6>
                                {% if SURUM_NOTLARI and SURUM_NOTLARI[0] %}
                                    <span class="text-secondary small">Son Güncelleme: {{ SURUM_NOTLARI[0].yayin_tarihi | format_tarih_str }}</span>
                                {% endif %}
                            </div>
                            <div class="accordion" id="guncellemeNotlariAccordion">
                                {% if not SURUM_NOTLARI %}
                                    <p>Yüklenecek sürüm notu bulunamadı.</p>
                                {% else %}
                                    {% for surum in SURUM_NOTLARI %}
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button {{ 'collapsed' if not loop.first }}" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-{{ surum.id }}" aria-expanded="{{ 'true' if loop.first else 'false' }}">
                                                <strong>Sürüm {{ surum.surum_no }} - ({{ surum.yayin_tarihi | format_tarih_str }})</strong>
                                            </button>
                                        </h2>
                                        <div id="collapse-{{ surum.id }}" class="accordion-collapse collapse {{ 'show' if loop.first }}" data-bs-parent="#guncellemeNotlariAccordion">
                                            <div class="accordion-body">
                                                <ul>
                                                {% for line in surum.notlar.split('\n') %}
                                                    {% if line.strip() %}
                                                    <li>{{ line.replace('- ', '') }}</li>
                                                    {% endif %}
                                                {% endfor %}
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                {% endif %}
                            </div>
                        </div>

                        <div class="tab-pane fade" id="iletisim-pane" role="tabpanel" aria-labelledby="iletisim-tab" tabindex="0">
                            <h5>Teknik Destek ve Geri Bildirim</h5>
                            <p>Uygulama ile ilgili herhangi bir sorun, öneri veya geri bildirim için aşağıdaki e-posta adresi üzerinden bizimle iletişime geçebilirsiniz.</p>
                            <div class="text-center mt-4">
                                <a href="mailto:destek@sutaski.com?subject=Süt Takip Sistemi Geri Bildirim" class="btn btn-primary">
                                    <i class="bi bi-envelope-fill me-2"></i>destek@sutaski.com
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="sifreDegistirModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered modal-sm"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Şifre Değiştir</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="mb-2"><label for="mevcut-sifre-input" class="form-label">Mevcut Şifreniz</label><input type="password" class="form-control form-control-sm" id="mevcut-sifre-input"></div><div class="mb-2"><label for="kullanici-yeni-sifre-input" class="form-label">Yeni Şifre</label><input type="password" class="form-control form-control-sm" id="kullanici-yeni-sifre-input"></div><div class="mb-2"><label for="kullanici-yeni-sifre-tekrar-input" class="form-label">Yeni Şifre (Tekrar)</label><input type="password" class="form-control form-control-sm" id="kullanici-yeni-sifre-tekrar-input"></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">İptal</button><button type="button" class="btn btn-primary btn-sm" onclick="sifreDegistir()">Kaydet</button></div></div></div></div>

</body>
</html>